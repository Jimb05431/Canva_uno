<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uno Card Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&amp;family=Nunito:wght@400;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    .font-bangers { font-family: 'Bangers', cursive; }
    .font-nunito { font-family: 'Nunito', sans-serif; }
    
    .card {
      width: 70px;
      height: 100px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.5rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      border: 3px solid white;
    }
    
    .card:hover:not(.card-back) {
      transform: translateY(-10px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    }
    
    .card-red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
    .card-blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; }
    .card-green { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; }
    .card-yellow { background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%); color: #1a1a1a; }
    .card-wild { background: linear-gradient(135deg, #ef4444 25%, #3b82f6 25%, #3b82f6 50%, #22c55e 50%, #22c55e 75%, #eab308 75%); color: white; }
    
    .card-back {
      background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
      color: #ef4444;
      cursor: default;
    }
    
    .card-inner {
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      width: 50px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      transform: rotate(-20deg);
    }
    
    .card-small {
      width: 50px;
      height: 70px;
      font-size: 1rem;
    }
    
    .card-small .card-inner {
      width: 35px;
      height: 50px;
    }
    
    .deck-pile {
      position: relative;
    }
    
    .deck-pile::before,
    .deck-pile::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
      border: 3px solid white;
    }
    
    .deck-pile::before {
      top: 4px;
      left: 4px;
      z-index: -1;
    }
    
    .deck-pile::after {
      top: 8px;
      left: 8px;
      z-index: -2;
    }
    
    .color-picker {
      display: flex;
      gap: 10px;
      padding: 20px;
      background: rgba(0,0,0,0.9);
      border-radius: 16px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100;
    }
    
    .color-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      border: 4px solid white;
      transition: transform 0.2s;
    }
    
    .color-btn:hover {
      transform: scale(1.2);
    }
    
    .opponent-hand {
      display: flex;
      gap: -20px;
      justify-content: center;
    }
    
    .player-hand {
      display: flex;
      gap: 5px;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 100%;
      padding: 0 10px;
    }
    
    @keyframes dealCard {
      from { transform: translateY(-200px) rotate(180deg); opacity: 0; }
      to { transform: translateY(0) rotate(0); opacity: 1; }
    }
    
    .deal-animation {
      animation: dealCard 0.3s ease-out;
    }
    
    .uno-logo {
      text-shadow: 3px 3px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000;
    }
    
    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 20px 40px;
      border-radius: 16px;
      font-size: 1.5rem;
      font-weight: bold;
      z-index: 50;
      animation: fadeInOut 2s ease-in-out;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    }
    
    .playable {
      box-shadow: 0 0 20px 5px rgba(255,255,255,0.6);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full font-nunito">
  <div id="app" class="h-full w-full bg-gradient-to-br from-emerald-800 via-emerald-700 to-emerald-900 flex flex-col overflow-auto"><!-- Start Screen -->
   <div id="start-screen" class="flex-1 flex flex-col items-center justify-center p-4">
    <h1 id="game-title" class="font-bangers text-7xl text-red-500 uno-logo mb-8 tracking-wider">UNO</h1>
    <div class="flex flex-col gap-4"><button onclick="startGame(1)" class="bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-8 rounded-full text-xl transition-all hover:scale-105 shadow-lg"> Play vs 1 Opponent </button> <button onclick="startGame(2)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-full text-xl transition-all hover:scale-105 shadow-lg"> Play vs 2 Opponents </button> <button onclick="startGame(3)" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full text-xl transition-all hover:scale-105 shadow-lg"> Play vs 3 Opponents </button>
    </div>
    <p class="text-white/70 mt-8 text-center max-w-md">Match cards by color or number. Special cards change the game!<br>
      First to empty your hand wins! ðŸŽ‰</p>
   </div><!-- Game Screen -->
   <div id="game-screen" class="hidden flex-1 flex flex-col p-2" style="min-height: 100%;"><!-- Opponent Areas -->
    <div id="opponents-area" class="flex justify-center gap-8 mb-2"><!-- Opponents will be rendered here -->
    </div><!-- Game Info -->
    <div class="text-center mb-2"><span id="current-turn" class="text-white font-bold text-lg bg-black/30 px-4 py-1 rounded-full"></span>
    </div><!-- Center Play Area -->
    <div class="flex-1 flex items-center justify-center gap-8 mb-4"><!-- Draw Pile -->
     <div class="flex flex-col items-center gap-2">
      <div class="deck-pile card card-back" onclick="drawCard()"><span class="font-bangers text-2xl">UNO</span>
      </div><span class="text-white/70 text-sm" id="deck-count">Cards: 0</span>
     </div><!-- Discard Pile -->
     <div class="flex flex-col items-center gap-2">
      <div id="discard-pile" class="card"><!-- Current card shown here -->
      </div><span class="text-white/70 text-sm">Discard</span>
     </div>
    </div><!-- Current Color Indicator -->
    <div class="text-center mb-2"><span class="text-white/70 text-sm">Current Color: </span> <span id="current-color-indicator" class="font-bold px-3 py-1 rounded-full text-white"></span>
    </div><!-- Player Hand -->
    <div class="bg-black/20 rounded-t-3xl p-4">
     <div class="text-center mb-2"><span class="text-white font-bold">Your Hand</span> <button id="uno-button" onclick="callUno()" class="ml-4 bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-4 rounded-full text-sm hidden transition-all"> UNO! </button>
     </div>
     <div id="player-hand" class="player-hand"><!-- Player cards rendered here -->
     </div>
    </div>
   </div><!-- Color Picker Modal -->
   <div id="color-picker" class="color-picker hidden">
    <p class="text-white font-bold mb-2 w-full text-center">Choose a color:</p>
    <div class="flex gap-3"><button onclick="selectColor('red')" class="color-btn bg-red-500"></button> <button onclick="selectColor('blue')" class="color-btn bg-blue-500"></button> <button onclick="selectColor('green')" class="color-btn bg-green-500"></button> <button onclick="selectColor('yellow')" class="color-btn bg-yellow-500"></button>
    </div>
   </div><!-- Toast Messages -->
   <div id="toast-container"></div><!-- Win Screen -->
   <div id="win-screen" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
    <div class="text-center">
     <h2 id="winner-text" class="font-bangers text-5xl text-yellow-400 mb-4"></h2><button onclick="resetGame()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full text-xl transition-all hover:scale-105"> Play Again </button>
    </div>
   </div>
  </div>
  <script>
    // Config and SDK Setup
    const defaultConfig = {
      game_title: 'UNO',
      primary_color: '#059669',
      text_color: '#ffffff'
    };
    
    let config = { ...defaultConfig };
    
    // Game State
    let deck = [];
    let players = [];
    let currentPlayerIndex = 0;
    let currentColor = '';
    let direction = 1;
    let numOpponents = 1;
    let pendingWildCard = null;
    let playerCalledUno = false;
    
    const COLORS = ['red', 'blue', 'green', 'yellow'];
    const VALUES = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'Skip', 'Reverse', '+2'];
    
    // Initialize SDK
    async function initSDK() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            updateUI();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              {
                get: () => cfg.primary_color || defaultConfig.primary_color,
                set: (value) => { cfg.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (value) => { cfg.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
              }
            ],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['game_title', cfg.game_title || defaultConfig.game_title]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
      }
      updateUI();
    }
    
    function updateUI() {
      const titleEl = document.getElementById('game-title');
      if (titleEl) {
        titleEl.textContent = config.game_title || defaultConfig.game_title;
      }
    }
    
    // Create the deck
    function createDeck() {
      const newDeck = [];
      
      COLORS.forEach(color => {
        VALUES.forEach((value, index) => {
          newDeck.push({ color, value });
          if (index > 0) {
            newDeck.push({ color, value });
          }
        });
      });
      
      for (let i = 0; i < 4; i++) {
        newDeck.push({ color: 'wild', value: 'Wild' });
        newDeck.push({ color: 'wild', value: '+4' });
      }
      
      return shuffleDeck(newDeck);
    }
    
    function shuffleDeck(deckToShuffle) {
      const shuffled = [...deckToShuffle];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    function startGame(opponents) {
      numOpponents = opponents;
      deck = createDeck();
      players = [];
      
      // Create player hands
      for (let i = 0; i <= numOpponents; i++) {
        players.push({
          name: i === 0 ? 'You' : `CPU ${i}`,
          hand: [],
          isPlayer: i === 0
        });
      }
      
      // Deal 7 cards to each player
      for (let i = 0; i < 7; i++) {
        players.forEach(player => {
          player.hand.push(deck.pop());
        });
      }
      
      // Set first card (skip wild cards)
      let firstCard = deck.pop();
      while (firstCard.color === 'wild') {
        deck.unshift(firstCard);
        deck = shuffleDeck(deck);
        firstCard = deck.pop();
      }
      currentColor = firstCard.color;
      
      currentPlayerIndex = 0;
      direction = 1;
      playerCalledUno = false;
      
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      
      renderGame(firstCard);
    }
    
    function renderGame(discardTop) {
      renderOpponents();
      renderPlayerHand();
      renderDiscardPile(discardTop);
      updateDeckCount();
      updateCurrentTurn();
      updateColorIndicator();
      checkUnoButton();
    }
    
    function renderOpponents() {
      const area = document.getElementById('opponents-area');
      area.innerHTML = '';
      
      for (let i = 1; i <= numOpponents; i++) {
        const opponent = players[i];
        const div = document.createElement('div');
        div.className = 'flex flex-col items-center';
        div.innerHTML = `
          <span class="text-white font-bold mb-1 ${currentPlayerIndex === i ? 'text-yellow-400' : ''}">${opponent.name} (${opponent.hand.length})</span>
          <div class="flex" style="margin-left: -${Math.min(opponent.hand.length * 15, 60)}px;">
            ${opponent.hand.map(() => `
              <div class="card card-small card-back" style="margin-left: -15px;">
                <span class="font-bangers text-xs">UNO</span>
              </div>
            `).join('')}
          </div>
        `;
        area.appendChild(div);
      }
    }
    
    function renderPlayerHand() {
      const hand = document.getElementById('player-hand');
      const playerHand = players[0].hand;
      hand.innerHTML = '';
      
      playerHand.forEach((card, index) => {
        const cardEl = createCardElement(card, index);
        const isPlayable = canPlayCard(card);
        if (isPlayable && currentPlayerIndex === 0) {
          cardEl.classList.add('playable');
        }
        hand.appendChild(cardEl);
      });
    }
    
    function createCardElement(card, index) {
      const div = document.createElement('div');
      const colorClass = card.color === 'wild' ? 'card-wild' : `card-${card.color}`;
      div.className = `card ${colorClass} deal-animation`;
      div.style.animationDelay = `${index * 0.05}s`;
      
      let displayValue = card.value;
      if (card.value === 'Skip') displayValue = 'âŠ˜';
      if (card.value === 'Reverse') displayValue = 'âŸ²';
      if (card.value === '+2') displayValue = '+2';
      if (card.value === '+4') displayValue = '+4';
      if (card.value === 'Wild') displayValue = 'âœ¦';
      
      div.innerHTML = `<div class="card-inner">${displayValue}</div>`;
      div.onclick = () => playCard(index);
      
      return div;
    }
    
    function renderDiscardPile(card) {
      const pile = document.getElementById('discard-pile');
      const colorClass = card.color === 'wild' ? `card-${currentColor}` : `card-${card.color}`;
      pile.className = `card ${colorClass}`;
      
      let displayValue = card.value;
      if (card.value === 'Skip') displayValue = 'âŠ˜';
      if (card.value === 'Reverse') displayValue = 'âŸ²';
      if (card.value === '+2') displayValue = '+2';
      if (card.value === '+4') displayValue = '+4';
      if (card.value === 'Wild') displayValue = 'âœ¦';
      
      pile.innerHTML = `<div class="card-inner">${displayValue}</div>`;
    }
    
    function updateDeckCount() {
      document.getElementById('deck-count').textContent = `Cards: ${deck.length}`;
    }
    
    function updateCurrentTurn() {
      const turnEl = document.getElementById('current-turn');
      turnEl.textContent = currentPlayerIndex === 0 ? "Your Turn!" : `${players[currentPlayerIndex].name}'s Turn`;
      turnEl.className = `text-white font-bold text-lg px-4 py-1 rounded-full ${currentPlayerIndex === 0 ? 'bg-green-500' : 'bg-black/30'}`;
    }
    
    function updateColorIndicator() {
      const indicator = document.getElementById('current-color-indicator');
      const colorMap = {
        red: 'bg-red-500',
        blue: 'bg-blue-500',
        green: 'bg-green-500',
        yellow: 'bg-yellow-500'
      };
      indicator.className = `font-bold px-3 py-1 rounded-full ${colorMap[currentColor] || 'bg-gray-500'} ${currentColor === 'yellow' ? 'text-black' : 'text-white'}`;
      indicator.textContent = currentColor.charAt(0).toUpperCase() + currentColor.slice(1);
    }
    
    function canPlayCard(card) {
      const topCard = getTopDiscard();
      if (card.color === 'wild') return true;
      if (card.color === currentColor) return true;
      if (card.value === topCard.value) return true;
      return false;
    }
    
    function getTopDiscard() {
      const pile = document.getElementById('discard-pile');
      const inner = pile.querySelector('.card-inner');
      let value = inner ? inner.textContent : '';
      
      if (value === 'âŠ˜') value = 'Skip';
      if (value === 'âŸ²') value = 'Reverse';
      if (value === 'âœ¦') value = 'Wild';
      
      return { color: currentColor, value };
    }
    
    function playCard(index) {
      if (currentPlayerIndex !== 0) return;
      
      const card = players[0].hand[index];
      if (!canPlayCard(card)) {
        showToast("Can't play that card!");
        return;
      }
      
      executePlay(0, index);
    }
    
    function executePlay(playerIndex, cardIndex) {
      const player = players[playerIndex];
      const card = player.hand.splice(cardIndex, 1)[0];
      
      if (card.color !== 'wild') {
        currentColor = card.color;
      }
      
      renderDiscardPile(card);
      
      // Check for winner
      if (player.hand.length === 0) {
        setTimeout(() => showWinner(player.name), 500);
        return;
      }
      
      // Check for Uno
      if (playerIndex === 0 && player.hand.length === 1 && !playerCalledUno) {
        showToast("You forgot to call UNO! Drawing 2 cards...");
        for (let i = 0; i < 2; i++) {
          if (deck.length > 0) player.hand.push(deck.pop());
        }
      }
      playerCalledUno = false;
      
      // Handle special cards
      if (card.color === 'wild') {
        if (playerIndex === 0) {
          pendingWildCard = card;
          document.getElementById('color-picker').classList.remove('hidden');
          return;
        } else {
          currentColor = COLORS[Math.floor(Math.random() * COLORS.length)];
          if (card.value === '+4') {
            applyDrawCards(4);
          }
        }
      } else if (card.value === 'Skip') {
        showToast(`${players[getNextPlayer()].name} skipped!`);
        nextTurn();
      } else if (card.value === 'Reverse') {
        direction *= -1;
        if (numOpponents === 1) {
          showToast("Direction reversed (acts as skip)");
          nextTurn();
        } else {
          showToast("Direction reversed!");
        }
      } else if (card.value === '+2') {
        applyDrawCards(2);
      }
      
      nextTurn();
      renderGame(card);
      
      if (currentPlayerIndex !== 0) {
        setTimeout(cpuTurn, 1000);
      }
    }
    
    function selectColor(color) {
      currentColor = color;
      document.getElementById('color-picker').classList.add('hidden');
      
      if (pendingWildCard && pendingWildCard.value === '+4') {
        applyDrawCards(4);
      }
      pendingWildCard = null;
      
      nextTurn();
      renderGame(getTopDiscard());
      
      if (currentPlayerIndex !== 0) {
        setTimeout(cpuTurn, 1000);
      }
    }
    
    function applyDrawCards(count) {
      const targetIndex = getNextPlayer();
      const target = players[targetIndex];
      showToast(`${target.name} draws ${count} cards!`);
      
      for (let i = 0; i < count; i++) {
        if (deck.length > 0) {
          target.hand.push(deck.pop());
        }
      }
      nextTurn();
    }
    
    function getNextPlayer() {
      let next = currentPlayerIndex + direction;
      if (next > numOpponents) next = 0;
      if (next < 0) next = numOpponents;
      return next;
    }
    
    function nextTurn() {
      currentPlayerIndex = getNextPlayer();
    }
    
    function drawCard() {
      if (currentPlayerIndex !== 0) return;
      if (deck.length === 0) {
        showToast("Deck is empty!");
        return;
      }
      
      const card = deck.pop();
      players[0].hand.push(card);
      showToast("Drew a card");
      
      nextTurn();
      renderGame(getTopDiscard());
      
      if (currentPlayerIndex !== 0) {
        setTimeout(cpuTurn, 1000);
      }
    }
    
    function cpuTurn() {
      if (currentPlayerIndex === 0) return;
      
      const cpu = players[currentPlayerIndex];
      let playableIndex = -1;
      
      // Find a playable card (prefer non-wild)
      for (let i = 0; i < cpu.hand.length; i++) {
        if (canPlayCard(cpu.hand[i])) {
          if (cpu.hand[i].color !== 'wild') {
            playableIndex = i;
            break;
          } else if (playableIndex === -1) {
            playableIndex = i;
          }
        }
      }
      
      if (playableIndex !== -1) {
        executePlay(currentPlayerIndex, playableIndex);
      } else {
        // Draw a card
        if (deck.length > 0) {
          cpu.hand.push(deck.pop());
          showToast(`${cpu.name} draws a card`);
        }
        nextTurn();
        renderGame(getTopDiscard());
        
        if (currentPlayerIndex !== 0) {
          setTimeout(cpuTurn, 1000);
        }
      }
    }
    
    function checkUnoButton() {
      const btn = document.getElementById('uno-button');
      if (players[0].hand.length === 2 && currentPlayerIndex === 0) {
        btn.classList.remove('hidden');
      } else {
        btn.classList.add('hidden');
      }
    }
    
    function callUno() {
      playerCalledUno = true;
      showToast("UNO! ðŸŽ‰");
      document.getElementById('uno-button').classList.add('hidden');
    }
    
    function showToast(message) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast font-nunito';
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }
    
    function showWinner(name) {
      document.getElementById('winner-text').textContent = name === 'You' ? 'ðŸŽ‰ You Win! ðŸŽ‰' : `${name} Wins!`;
      document.getElementById('win-screen').classList.remove('hidden');
    }
    
    function resetGame() {
      document.getElementById('win-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.add('hidden');
      document.getElementById('start-screen').classList.remove('hidden');
    }
    
    // Initialize
    initSDK();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c64a859e7e8c336',t:'MTc2OTgxNDc4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
